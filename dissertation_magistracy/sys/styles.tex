%%% Язык текста %%%
\selectlanguage{russian}

%%% Кодировки и шрифты %%%
\renewcommand{\rmdefault}{ftm} % Включаем Times New Roman

%%% Макет страницы %%%
\geometry{a4paper,top=20mm,left=30mm,right=10mm,bottom=20mm}
\setstretch{1.07}

%%% Выравнивание и переносы %%%
\sloppy                 % Избавляемся от переполнений
\clubpenalty=10000      % Запрещаем разрыв страницы после первой строки абзаца
\widowpenalty=10000     % Запрещаем разрыв страницы после последней строки абзаца
\interfootnotelinepenalty=10000 % Запрет разрывов сносок

%%% Настройки полей %%%

% Титульная страница
\fancypagestyle{empty}{%
\fancyhf{} % clear all header and footer fields
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\setlength{\footskip}{0mm}
\setlength{\headheight}{0mm}
}

% Основной текст
\fancypagestyle{plain}{%
\fancyhf{} % clear all header and footer fields
\fancyfoot[R]{\thepage}
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}
\setlength{\footskip}{0mm}
\setlength{\headheight}{0mm}
}

\pagestyle{plain}

%%% Оформление текста

\setlength{\parskip}{0mm}
\setlength{\parindent}{1.25cm}
\raggedbottom{}

\renewcommand\floatpagefraction{.9}
\renewcommand\dblfloatpagefraction{.9} % for two column documents
\renewcommand\topfraction{.9}
\renewcommand\dbltopfraction{.9}       % for two column documents
\renewcommand\bottomfraction{.9}
\renewcommand\textfraction{.1}
\setcounter{totalnumber}{50}
\setcounter{topnumber}{50}
\setcounter{bottomnumber}{50}

%%% Оформление заголовков
\newcommand{\chapterbreak}{\clearpage}

\titleformat{\chapter}[display]{\large\bfseries\filcenter}{ГЛАВА \thechapter}{0mm}{\MakeUppercase}
\titlespacing*{\chapter}{0mm}{0mm}{2\baselineskip}

\titleformat{name=\chapter,numberless}{\large\bfseries\filcenter}{}{0mm}{\MakeUppercase}
\titlespacing*{name=\chapter,numberless}{0mm}{0mm}{2\baselineskip}

\titleformat{\section}{\large\bfseries}{\thesection}{\wordsep}{}
\titlespacing*{\section}{\parindent}{0mm}{2\baselineskip}

\titleformat{\subsection}{\normalsize\bfseries}{\thesubsection}{\wordsep}{}
\titlespacing*{\subsection}{\parindent}{0mm}{2\baselineskip}

% \titleformat{\subsubsection}{\normalsize\bfseries}{\thesubsubsection}{\wordsep}{}
% \titlespacing*{\subsubsection}{\parindent}{\baselineskip}{\baselineskip}

\counterwithout{paragraph}{subsubsection}
\counterwithin{paragraph}{subsection}
\renewcommand{\theparagraph}{\thesubsection.\arabic{paragraph}}
\setcounter{secnumdepth}{4}

\titleformat{name=\paragraph}[runin]{\normalsize\bfseries}{\theparagraph}{\wordsep}{}
\titlespacing*{\paragraph}{\parindent}{\baselineskip}{\wordsep}

%%% Оформление списков
\setlist[1]{itemindent=1.85cm,leftmargin=0mm,itemsep=0mm,topsep=0mm,parsep=0mm}
\setlist[itemize,1]{label=---}
\setlist[enumerate,1]{label=\arabic*}

\setlist[2]{itemindent=3.1cm,leftmargin=0mm,itemsep=0mm,topsep=0mm,parsep=0mm}

% Cтиль для списков, на которые есть ссылки в тексте
\AddEnumerateCounter{\asbuk}{\@asbuk}{\cyrm}
\newlist{reflist}{enumerate}{1}
\setlist*[reflist,1]{label=\asbuk*)}
\setlist*[reflist,2]{label=\arabic*)}

%%% Оформление сносок

\deffootnote[1.65cm]{0mm}{1.25cm}{\textsuperscript{\thefootnotemark) }}
\renewcommand{\footnotesize}{\normalsize\selectfont}
\setlength{\footnotesep}{\parsep}

%%% Оформление ссылок
\urlstyle{same}

%%% Размеры текста формул %%%

\DeclareMathSizes{12}{12}{6}{4}

%%% Расстояние между формулами

\AtBeginDocument{%
  \setlength\abovedisplayskip{\baselineskip}%
  \setlength\belowdisplayskip{\baselineskip}%
  \setlength\abovedisplayshortskip{\baselineskip}%
  \setlength\belowdisplayshortskip{\baselineskip}%
}

%%% Расстояние между плавающими элементами

\setlength{\floatsep}{1.5\baselineskip plus 0mm minus 0mm}     % between top floats
\setlength{\textfloatsep}{1.5\baselineskip plus 0mm minus 0mm} % between top/bottom floats and text
\setlength{\intextsep}{1.5\baselineskip plus 0mm minus 0mm}    % between text and float
\setlength{\dbltextfloatsep}{1.5\baselineskip plus 0mm minus 0mm}
\setlength{\dblfloatsep}{1.5\baselineskip plus 0mm minus 0mm}

%% Нумерация плавающих элементов

\counterwithin{figure}{chapter}
\counterwithin{table}{chapter}
\counterwithin{equation}{chapter}

\makeatletter
\AtBeginDocument{%
\renewcommand{\thetable}{\thechapter.\arabic{table}}
\renewcommand{\thelstlisting}{\thechapter.\arabic{lstlisting}}
\renewcommand{\thefigure}{\thechapter.\arabic{figure}}
\let\c@lstlisting\c@figure}
\makeatother

%% Подписи плавающих элементов

\fboxsep=4mm
\fboxrule=0.1mm

\captionsetup[figure]{
  labelsep=endash,
  justification=centering,
  singlelinecheck=false,
  position=bottom,
  parskip=\parskip,
  belowskip=-0.6\baselineskip,
  skip=1.4\baselineskip}

\captionsetup[table]{
  labelsep=endash,
  justification=raggedright,
  singlelinecheck=false,
  position=top,
  belowskip=-0.4\baselineskip,
  skip=0mm}

\captionsetup[longtable]{
  labelsep=endash,
  justification=raggedright,
  singlelinecheck=false,
  position=top,
  belowskip=0.4\baselineskip,
  skip=0mm}

\captionsetup[lstlisting]{
  labelsep=endash
}

\lstset{
basicstyle=\scriptsize\ttfamily,
numberstyle=\scriptsize\ttfamily,
keywordstyle=\bfseries,
commentstyle=\itshape,
numbers=left,
stepnumber=1,
frame=single,
resetmargins=true,
xleftmargin=7mm,
xrightmargin=2mm,
captionpos=b,
keepspaces=true,
breaklines=true,
aboveskip=1.6\baselineskip,
belowskip=1.4\baselineskip,
abovecaptionskip=1.2\baselineskip}

\renewcommand{\arraystretch}{1.5}

%%% Настройка размеров вертикальных отступов

\renewcommand{\smallskip}{\vspace{0.3\baselineskip}}
\renewcommand{\bigskip}{\vspace{\baselineskip}}

%%% Содержание %%%
\renewcommand{\cfttoctitlefont}{\hfil\large\bfseries\MakeUppercase}

\setlength{\cftbeforetoctitleskip}{0mm}
\setlength{\cftaftertoctitleskip}{2\baselineskip}
\setlength{\cftparskip}{0mm}
\cftsetpnumwidth{4mm}

\setlength{\cftbeforechapskip}{0mm}
\setlength{\cftchapindent}{0mm}
\setlength{\cftchapnumwidth}{4mm}
\renewcommand{\cftchapfont}{}
\renewcommand{\cftchappagefont}{\normalsize}
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}

\setlength{\cftbeforesecskip}{0mm}
\setlength{\cftsecindent}{4mm}
\setlength{\cftsecnumwidth}{8mm}
\renewcommand{\cftsecfont}{}
\renewcommand{\cftsecpagefont}{\normalsize}
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}

\setlength{\cftbeforesubsecskip}{0mm}
\setlength{\cftsubsecindent}{12mm}
\setlength{\cftsubsecnumwidth}{12mm}


%%% Библиография %%%

\makeatletter
\bibliographystyle{sys/ugost2003} % Оформляем библиографию в соответствии с ГОСТ 7.1 2003

\let\oldthebibliography=\thebibliography
\let\endoldthebibliography=\endthebibliography
\renewenvironment{thebibliography}[1]{
  \begin{oldthebibliography}{#1}
    \setlength{\parskip}{0mm}
    \setlength{\itemsep}{0mm}
}
{
\end{oldthebibliography}
}
